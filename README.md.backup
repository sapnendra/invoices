# Invoice Details Module

A full-stack MERN application for managing invoices and processing payments with a clean, modern UI.

## Tech Stack

- **Backend:** Node.js, Express, MongoDB, Mongoose
- **Frontend:** Next.js 16 (with App Router), React, Tailwind CSS
- **Validation:** Joi (backend)
- **Architecture:** Service Layer Pattern, Transaction-based Payments
- **Currency:** Indian Rupees (‚Çπ)

## Project Structure

```
invoice-details-page/
‚îú‚îÄ‚îÄ server/          # Backend API
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/      # Database & constants
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/      # Mongoose models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/    # Business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/ # Request handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/      # API routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/  # Validation & error handling
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/       # Helper functions
‚îÇ   ‚îî‚îÄ‚îÄ scripts/     # Seed data
‚îú‚îÄ‚îÄ client/          # Frontend (Next.js)
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ app/         # Next.js app router
‚îÇ       ‚îú‚îÄ‚îÄ components/  # React components
‚îÇ       ‚îî‚îÄ‚îÄ lib/         # API client & utilities
‚îî‚îÄ‚îÄ README.md
```

## Features

### Core Functionality
- View invoice details with line items
- Display payment history
- Add new payments with validation
- Automatic balance calculation
- Status management (DRAFT ‚Üí PAID)
- Archive/restore invoices
- MongoDB transactions for data integrity

### UI Features
- Fully responsive design
- Clean, modern interface inspired by provided design
- Optimistic UI updates
- Loading states and error handling
- Payment progress visualization
- Indian Rupees (‚Çπ) with proper formatting (‚Çπ1,25,000.00)
- Server-side rendering for performance

## Prerequisites

- Node.js (v18 or higher)
- MongoDB (v6 or higher)
- npm or yarn

## Setup Instructions

### Step 1: Navigate to Project Directory

```bash
cd /home/sapnendra/Desktop/MeruTechnoSoft/Invoice-Details-Page
```

### Step 2: Install Backend Dependencies

```bash
cd server
npm install
```

### Step 3: Install Frontend Dependencies

```bash
cd client
npm install
```

### Step 4: Configure Environment

The backend `.env` file is already created in the `server/` directory with the following settings:

```
NODE_ENV=development
PORT=5000
MONGODB_URI=mongodb://localhost:27017/invoice_db
CLIENT_URL=http://localhost:3000
```

Verify these settings match your environment:

```bash
cd server
cat .env
```

### Step 5: Start MongoDB

Ensure MongoDB is running on your system:

**Linux:**
```bash
sudo systemctl start mongod
sudo systemctl status mongod
```

**macOS:**
```bash
brew services start mongodb-community
The seed script creates 12 diverse sample invoices
```

### Step 6: Seed Sample Data

From the `server/` directory, run:

```bash
npm run seed
```

This will create 12 sample invoices with various payment scenarios. Note the Invoice IDs displayed in the console output for testing.

## How to Run Backend

Navigate to the server directory and start the development server:

```bash
cd server
npm run dev
```

The backend API will run on `http://localhost:5000`

### Available Backend Scripts

- `npm run dev` - Start development server with nodemon (auto-restart on changes)
- `npm start` - Start production server
- `npm run seed` - Populate database with sample data

### Backend Endpoints

The API will be available at `http://localhost:5000/api`

## How to Run Frontend

Open a new terminal, navigate to the client directory, and start the development server:

```bash
cd client
npm run dev
```

The frontend application will run on `http://localhost:3000`

### Available Frontend Scripts

- `npm run dev` - Start Next.js development server with Turbopack
- `npm run build` - Build for production
- `npm start` - Start production server
- `npm run lint` - Run ESLint

### Access the Application

Open your browser and navigate to:
- **Homepage:** `http://localhost:3000` - View invoice dashboard
- Multiple realistic line items per invoice
- Various payment histories (single, installments, none)
- Different invoice sizes (‚Çπ18,500 to ‚Çπ3,50,000)
- One archived invoice for testing
- All amounts in Indian Rupees (‚Çπ)

After seeding, the console displays all Invoice IDs for testing.

##al: ‚Çπ85,000
- Amount Paid: ‚Çπ35,000
- Balance Due: ‚Çπ50,000

**2. INV-2026-002** - Tech Solutions Inc
- Status: PAID (fully paid)
- Total: ‚Çπ1,25,000
- Amount Paid: ‚Çπ1,25,000
- Balance Due: ‚Çπ0

**3. INV-2026-003** - Global Innovations Ltd
- Status: DRAFT (no payment yet)
- Total: ‚Çπ45,000
- Amount Paid: ‚Çπ0
- Balance Due: ‚Çπ45,000

**4. INV-2026-004** - Quantum Systems Pvt Ltd
- Status: DRAFT (large invoice, partial)
- Total: ‚Çπ2,50,000
- Amount Paid: ‚Çπ1,00,000
- Balance Due: ‚Çπ1,50,000

**5. INV-2026-005** - Startup Hub India
- Status: PAID (small invoice)
- Total: ‚Çπ18,500
- Balance: ‚Çπ0

**6. INV-2026-006** - Digital Marketing Pro
- Status: DRAFT (almost paid)
- Total: ‚Çπ67,500
- Balance Due: ‚Çπ7,500
85000,
      "amountPaid": 35000,
      "balanceDue": 50000
    }
  }
}
```

#### Add Payment
```http
POST /api/invoices/:id/payments
Content-Type: application/json

{
  "amount": 25000,
  "paymentDate": "2026-02-1
**10-12.** Three additional invoices with various statuses

### Seed Data Features:
- Multiple realistic line items per invoice
- Various payment histories (single, installments, none)
- Different invoice sizes (‚Çπ18,500 to ‚Çπ3,50,000)
- One archived invoice for testing
- All amounts in Indian Rupees (‚Çπ)

After seeding, the console displays all Invoice IDs for testing
After seeding, note the Invoice IDs printed in the console.

## üì° API Endpoints

### Invoice Endpoints

#### Get Invoice Details
```http
GET /api/invoices/:id
```

**Response:**
```json
{
  "success": true,
  "data": {
    "invoice": { /* invoice object */ },
    "lineItems": [ /* array of line items */ ],
    "payments": [ /* array of payments */ ],
    "calculated": {
      "total": 2000,
      "amountPaid": 500,
      "balanceDue": 1500
    }
  }
}
```

#### Add Payment
```http
POST /api/invoices/:id/payments
Content-Type: application/json

{
  "amount": 500,
  "paymentDate": "2024-08-25"
}
```

**Validation Rules:**
- Amount must be > 0
- Amount cannot exceed balance due
- Payment date cannot be in the future
- Cannot add payment to archived invoice
- Cannot add payment to fully paid invoice

#### Archive Invoice
```http
POST /api/invoices/:id/archive
```

#### Restore Invoice
```http
POST /api/invoices/:id/restore
```

## üß™ Testing the Application

### 1. View Invoice Dashboard
Navigate to: `http://localhost:3000`

The homepage displays 9 invoice cards with different statuses:
- ‚è≥ Partial payments (invoices with balance due)
- Partial payments (invoices with balance due)
- Fully paid invoices
- Unpaid invoices
-
Click any card to view full invoice details.

### 2. View Invoice Details
Navigate to: `http://localhost:3000/invoices/{INVOICE_ID}`

Replace `{INVOICE_ID}` with one of the IDs from the seed script output.

### 3. Add a Payment
1. Click "Add Payment" button
2. Enter amount (try partial payment: ‚Çπ25,000)
3. Use quick amount buttons (25%, 50%, or Full Amount)
4. Select payment date
5. Click "Add Payment"
6. Observe real-time updates to totals and progress bar

### 4. Test Validationmodern invoice management systems with:
- Clean white cards with subtle shadows
- Green primary color (#22c55e)
- Professional typography hierarchy
- Responsive grid layout (mobile, tablet, desktop)
- Hover states and smooth transitions
- Indian Rupee (‚Çπ) formatting with proper comma separators
- Visual payment progress indicator
### 5. Test Full Payment
1. Add payment equal to remaining balance
2. Status should change from DRAFT to "PAID"
3. "Add Payment" button should disappear
4. Progress bar shows 100%
5. "Fully Paid ‚úì" message appears
" message appears

##
The UI is inspired by the provided Monefy invoice design with:
- Clean white cards with subtle shadows
- Green primary color (#22c55e)
- Professional typography hierarchy
- Responsive grid layout
- Hover states and smooth transitions

## üèóÔ∏è Architecture Highlights

### Backend Architecture
- **Service Layer Pattern:** Business logic separated from controllers
- **MongoDB Transactions:** Atomic payment + invoice updates
- **Error Handling:** Centralized error handler with custom error classes
- **Validation:** Joi schemas for request validation
- **Calculation Helpers:** Reusable utility functions
Next.js 16 App Router:** Server components with async params handling
- **Server Components:** Initial data fetching for performance
- **Client Components:** Interactive features (modals, forms)
- **Optimistic Updates:** Immediate UI feedback
- **Component Composition:** Small, focused components
- **Custom Formatting:** Manual currency/date formatting for SSR reliability
- **Custom Hooks:** Reusable logic (usePayment)
- **Component Composition:** Small, focused components

## üîí Business Rules Enforced

1. **Overpayment Prevention:** Cannot pay more than balance due
2. **Status Automation:** Status ‚Üí PAID when balance = 0
3. **Archived Protection:** Cannot modify archived invoices
4. **Calculation Integrity:** Line totals = quantity √ó unit price
5. **Transaction Safety:** All payment operations are atomic
6. **Concurrent Safety:** Race condition protection via transactions

## Troubleshooting

### MongoDB Connection Error
```bash
# Check if MongoDB is running
sudo systemctl status mongod  # Linux
brew services list            # macOS

# Start MongoDB
sudo systemctl start mongod   # Linux
brew services start mongodb-community  # macOS
```

### Port Already in Use
```bash
# Kill process on port 5000
lsof -ti:5000 | xargs kill -9

# Kill process on port 3000
lsof -ti:3000 | xargs kill -9
```

### CORS Errors
Verify `CLIENT_URL` in `server/.env` matches your frontend URL (default: `http://localhost:3000`)

### Cannot Find Invoice
Make sure you're using a valid Invoice ID from the seed script output.

## üöÄ Production Deployment

### Backend
1. Set environment variables
2. Update `MONGODB_URI` to production database
3. Update `CLIENT_URL` to production frontend URL
4. Deploy to service like Heroku, Railway, or DigitalOcean

### Frontend
1. Update `NEXT_PUBLIC_API_URL` in `.env.local`
2. Run `npm run build`
3. Deploy to Vercel, Netlify, or similar

## üìö Additional Features (Optional Enhancements)

Future enhancements you  (with ‚Çπ formatting)
- [ ] Email payment receipts
- [ ] Invoice search and filtering
- [Bulk operations
- [ ] Payment method tracking (UPI, Card, Bank Transfer)
- [ ] GST/Tax calculations
- [ ] Dark mode
- [ ] Invoice templates
- [ ] Recurring invoices
- [ ] Payment reminders via email/SMS

## üÜï Recent Updates

### Version 2.0 (February 2026)
- Updated to Next.js 16 (with async params support)
- Currency changed from USD ($) to Indian Rupees (‚Çπ)
- Expanded seed data from 2 to 12 invoices
- Added realistic Indian business scenarios
- Fixed MongoDB driver deprecation warnings
- Improved currency formatting for Indian numbering system
- Enhanced homepage with invoice dashboard grid
- Added quick payment buttons (25%, 50%, Full)
- Better validation error messages with currency symbols
- [ ] Payment reminders

## ü§ù Contributing

This is a demo project. Feel free to fork and enhance!

## Recent Updates

### Version 2.0 (February 2026)
- Updated to Next.js 16 (with async params support)
- Currency changed from USD ($) to Indian Rupees (‚Çπ)
- Expanded seed data from 2 to 12 invoices
- Added realistic Indian business scenarios
- Fixed MongoDB driver deprecation warnings
- Improved currency formatting for Indian numbering system
- Enhanced homepage with invoice dashboard grid
- Added quick payment buttons (25%, 50%, Full)
- Better validation error messages with currency symbols

##
### üéØ Key Testing Scenarios

1. **Partial Payment:** INV-2026-001 (‚Çπ50,000 balance)
2. **Fully Paid:** INV-2026-002 (‚Çπ0 balance)
3. License

MIT

## Author

Built as part of the MeruTechnoSoft Invoice Details Module assignment.

---

## Quick Start Summary

### Terminal 1 - Backend
```bash
cd server
npm install
npm run seed      # Creates 12 sample invoices
npm run dev       # Runs on http://localhost:5000
```

### Terminal 2 - Frontend
```bash
cd client
npm install
npm run dev       # Runs on http://localhost:3000
```

### Access Application
Open your browser and navigate to `http://localhost:3000`

### Key Testing Scenarios

1. **Partial Payment:** INV-2026-001 (‚Çπ50,000 balance)
2. **Fully Paid:** INV-2026-002 (‚Çπ0 balance)
3. **No Payment:** INV-2026-003 (‚Çπ45,000 balance)
4. **Large Invoice:** INV-2026-004 (‚Çπ2,50,000 total)
5. **Archived:** INV-2025-099 (cannot modify)